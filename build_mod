#!/bin/bash

# Copies needed mod files, cooks, packs and creates metadata
# Usage: first argument is the path to the mod in form: /[driveLetter]/[restOfThePath]
# no '/' at the end
#
# Requirements:
# 1) wcc_lite in PATH
# 2) Mod directory structure:
#      [modWorkDir]/Cooked (cooked files)
#	   [modWorkDir]/Uncooked (uncooked files)
#	   [modWorkDir]/Packed/[modReadyFolder] (mod package)
#

# SCRIPT FILES BEGIN
scriptFile[0]="/game/player/playerWitcher.ws"
scriptFile[1]="/game/gui/menus/enchantingMenu.ws"
scriptFile[2]="/game/gui/_old/components/guiTooltipComponent.ws"
scriptFile[3]="/game/gui/_old/components/guiPlayerInventoryComponent.ws"
scriptFile[4]="/game/gameplay/items/spells/igniEntity.ws"
# SCRIPT FILES END

# ASSET FILES BEGIN
assetFile[0]="/gameplay/items/def_item_crafting_gloves.xml"
assetFile[1]="/gameplay/items_plus/def_item_crafting_gloves.xml"
assetFile[2]="/gameplay/items/def_item_upgrades.xml"
assetFile[3]="/gameplay/items_plus/def_item_upgrades.xml"

assetFile[4]="/dlc/bob/data/gameplay/items/def_item_crafting_gloves.xml"
assetFile[5]="/dlc/bob/data/gameplay/items_plus/def_item_crafting_gloves.xml"
assetFile[6]="/dlc/ep1/data/gameplay/items/def_item_ep1_runewords.xml"
assetFile[7]="/dlc/ep1/data/gameplay/items_plus/def_item_ep1_runewords.xml"

assetFile[8]="/gameplay/items_plus/def_item_crafting_armor.xml"
assetFile[9]="/gameplay/items_plus/def_item_crafting_boots.xml"
assetFile[10]="/gameplay/items_plus/def_item_crafting_pants.xml"
assetFile[11]="/gameplay/items_plus/def_item_crafting_weapons.xml"
assetFile[12]="/dlc/bob/data/gameplay/items_plus/def_item_crafting_pants.xml"
assetFile[13]="/dlc/dlc10/data/gameplay/items_plus/dlc10_wolf_armor.xml"
assetFile[14]="/dlc/dlc10/data/gameplay/items_plus/dlc10_wolf_swords.xml"
# ASSET FILES END

set -e

if [ -z $1 ]
then
    echo "Wrong path to the mod!"
	exit
fi

modReadyFolder=$1"/Packed/modGrandBalanceRepairEquip"
modContentPath=$modReadyFolder"/content"

inXMLPath="Uncooked"
inScriptPath="Script/scripts"

outScriptPath=$modContentPath"/scripts"

outXmlPath1=$1"/Uncooked"
outXmlPath2=$1"/Cooked"

if [ ${#scriptFile[@]} != 0 ];
then
	for i in "${scriptFile[@]}"
	do
		cp $inScriptPath$i $outScriptPath$i
	done
fi

if [ ${#assetFile[@]} != 0 ];
then
	for i in "${assetFile[@]}"
	do
		cp $inXMLPath$i $outXmlPath1$i
		cp $inXMLPath$i $outXmlPath2$i
	done
fi

if [ -d "ModRes/strings" ]; then
	cp -r ModRes/strings/* $modContentPath
fi

if [ -d "ModRes/bin" ]; then
	cp -r ModRes/bin $modReadyFolder
fi

echo "Files copied OK."

if [ ${#assetFile[@]} != 0 ];
then
	wcc_lite cook -platform=pc -mod=$outXmlPath1 -basedir=$outXmlPath1 -outdir=$outXmlPath2
	wcc_lite pack -dir=$outXmlPath2 -outdir=$modContentPath
	wcc_lite metadatastore -path=$modContentPath
fi
